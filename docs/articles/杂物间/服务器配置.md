---
title: 服务器配置
createDate: 2025-8-19 11:44:00
outline: deep
---

# {{ $frontmatter.title}}

::: info
在Github Page部署VitePress后，一直想试试购买一个国内云服务器部署站点，但又怕买了之后吃灰浪费钱，领取了3个月免费阿里云试用，在这里记录一些从零开始的配置过程。
:::

## 1. 镜像选择

可以选择 _应用镜像_ 或 _系统镜像_。

_应用镜像_ 可选：

1. 宝塔Linux面板
2. 翼龙面板
3. WordPress
   ...

_系统镜像_ 可选：

1. Ubuntu
2. CentOS
3. Debian
   ...

我个人理解是应用镜像除了操作系统本身，还预装了一些管理软件、数据库等，可以方便小白或者懒得折腾的用户快速构建自己的应用，不过我本来就是以学习为目的配置服务器的，并且平时也经常用Linux，缺的只是一些运维方面的经验，所以最终选择了Debian。
::: tip
Linux各发行版区别请自行百度，Debian和Ubuntu更像一些，少了GUI，但更稳定更适合服务器，像我一样平时用Ubuntu比较多的可以试试Debian。
:::

## 2. 开机

### 2.1. 配置用户

不知道是不是我点太快了没仔细看，通过Workbench连接服务器时默认免密登录root用户，也没让我配置root用户密码。

不过问题不大，点操作的省略号，选择重置实例密码，就可以重置root的密码了:

[![reset_passwd](https://origin.picgo.net/2025/08/25/2.reset_passwde4d50b76c6b73de0.webp)](https://www.picgo.net/image/2.reset-passwd.0GoB0i)

在root用户执行以下命令来新建用户并给予sudo权限：

```bash
adduser <用户名>    # 自动引导你设置密码、用户信息等，自动建立用户文件夹并配置默认shell为bash
usermod -aG sudo <用户名>  # 加入sudo组，
grep '^sudo:' /etc/group        # 查看sudo组成员
```

### 2.2. 踩坑：修改Shell（如果你用useradd而非adduser）

也算是个小坑，我之前在不太懂的情况下在阿里云的控制界面AI助手询问新建用户命令，助手给我的是useradd，我就直接用useradd <用户名>来新建用户了。

::: tip uesradd和adduser的区别
useradd是Linux系统原生的底层命令，需要手动配置更多参数，不会自动执行*新建home文件夹、配置默认shell、设置密码*等操作。

adduser是Ubuntu（Debian系）特有的脚本，本质上是useradd的封装，提供交互式操作，更适合手动创建用户。
:::

所以这就导致了我新建的用户默认采用sh作为shell，在sh下装了nvm、nodejs等一堆东西后，过一会重新连接服务器想运行node，结果统统提示找不到命令。

::: tip sh和bash的区别（字多可跳过）
sh是最早的Unix shell，简单来说，bash更先进更好用，sh对环境变量的管理和存储和bash有一定差异，所以用sh安装一些现代软件时会出现重启后找不到命令的问题。

下面是bash安装nvm的输出：

```bash{7-8}
user@address:~$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
...
- (HEAD detached at FETCH_HEAD)
  master
  => Compressing and cleaning up git repository

=> Appending nvm source string to /home/ggxxding2/.bashrc
=> Appending bash_completion source string to /home/ggxxding2/.bashrc
=> Close and reopen your terminal to start using nvm or run the following to use it now:

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion" # This loads nvm bash_completion
```

下面是sh安装nvm的输出：

```sh{7}
$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
...
* (HEAD detached at FETCH_HEAD)
  master
=> Compressing and cleaning up git repository

=> Profile not found. Tried ~/.bashrc, ~/.bash_profile, ~/.zprofile, ~/.zshrc, and ~/.profile.
=> Create one of them and run this script again
   OR
=> Append the following lines to the correct file yourself:

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm

=> Close and reopen your terminal to start using nvm or run the following to use it now:

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
```

可以看到sh在尝试找bash、zsh等的配置文件，但找不到，所以没有添加环境变量，问题就出在这里！！！

:::

我还奇怪怎么这么难用，没法按方向键⬆️来执行上一条命令，也不显示当前目录。

补救方法是更改用户的默认shell：

```bash{8}
useradd <用户名>    # 假设你用useradd新建了用户
passwd <用户名>     # useradd不会设置密码，要用passwd设置一下
usermod -aG sudo <用户名>  # 加和前面一样，给一下sudo权限
mkdir /home/<用户名>   # 新建一下HOME文件夹
chown <用户名>:<用户名> /home/<用户名>  # 更改所有者
echo $SHELL     #查看当前shell，大概率是/bin/sh
cat /etc/shells # 查看当前所有shell
chsh -s <shell路径> <用户名> # 修改用户默认shell，shell路径从/etc/shells选择
```

## 3. 安装环境

::: info
仅记录自己常用软件的安装过程。
:::

### 3.1. git

```bash
sudo apt update     # 直接install好像搜不到git，先执行一下update
sudo apt install git
```

### 3.2. node.js

参考[官网](https://nodejs.org/zh-cn/download):

```bash
# Download and install nvm:
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
# in lieu of restarting the shell
\. "$HOME/.nvm/nvm.sh"
# Download and install Node.js:
nvm install 22
# Verify the Node.js version:
node -v # Should print "v22.18.0".
nvm current # Should print "v22.18.0".
# Verify npm version:
npm -v # Should print "10.9.3".
```

### 3.3. nginx（并部署VitePress）

```bash
apt install nginx   # 可能也要先update
curl -i 127.0.0.1:80  # 安装完后执行，看到HTTP/1.1 200 OK以及Welcome to nginx等证明安装成功
# 以下是启动相关命令，curl成功了就不需要执行了
systemctl start nginx   # 启动
systemctl enable nginx  # 开机自启
systemctl is-enabled nginx  # 查询自启状态
# 附一些nginx常用指令
ps aux | grep nginx # 查看服务状态
nginx # 启动
nginx -s stop # 停止
nginx -s reload # 重载配置文件
```

在阿里云安全组中打开80端口，然后访问公网IP，如果看到Welcome页面，证明外网可访问：

[![Welcome](https://origin.picgo.net/2025/08/25/3.welcome1263836a736edd23.webp)](https://www.picgo.net/image/3.welcome.0GoYKN)

然后尝试更改为自己的页面，编辑/etc/nginx/nginx.conf：

```bash{11,16}
# 先把build好的静态页面目录放到/var/www/下，然后在http{}中增加如下内容
# server_name改为公网ip，root改为实际静态页面目录
# root目录要注意权限问题，否则即使目录正确也会报错404。建议和Welcome页一样放在/var/www/下
http {
    ......
    server {
        gzip on;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

        listen 80;
        server_name xx.xx.xx.xx;
        index index.html;

        location / {
            # content location
            root /var/www/ggxxding;

            # exact matches -> reverse clean urls -> folders -> not found
            try_files $uri $uri.html $uri/ =404;

            # non existent pages
            error_page 404 /404.html;

            # a folder without index.html raises 403 in this setup
            error_page 403 /404.html;

            # adjust caching headers
            # files in the assets folder have hashes filenames
            location ~* ^/assets/ {
                expires 1y;
                add_header Cache-Control "public, immutable";
            }
        }
    }
}
```

然后再sudo nginx -s reload，刷新公网ip页面，可能出现以下几种情况：

1. 项目页面正常显示（成功！本节结束！）；
2. 能显示内容，但无样式、静态资源（如下图，请阅读3.3.1）；
3. 403/404 Forbidden（请阅读3.3.2）。

[![page_without_css](https://origin.picgo.net/2025/08/25/4.page_without_css86153040bafc2795.webp)](https://www.picgo.net/image/4.page-without-css.0GoMiW)

#### 3.3.1. debug：设置项目base

没样式是因为路径没配置对，我之前把VitePress部署到Github Page了，所以修改过config中的base，只要去Vitepress项目目录/.vitepress/config.mjs中把base改回'/'即可，别忘了head的href也要把原来的base删掉。

```js{2-3}
export default defineConfig({
  base: '/',
  head: [['link', { rel: 'icon', href: '/img/阿响_宝可装置_HGSS.png' }]],
  ...
})
```

接着再build一下，放到nginx配置的root目录，刷新页面，大功告成！

[![page](https://origin.picgo.net/2025/08/25/5.pagec6c785fa2d314915.webp)](https://www.picgo.net/image/5.page.0GoZMf)

#### 3.3.2. debug：403或404的处理

另外如果403或404，不要着急，如果确认root没问题且root下有index.html，就去日志找找问题在哪：

```bash
cat /etc/nginx/nginx.conf # 查看配置，找一下error_log 默认是/var/log/nginx/error.log;

sudo cat /var/log/nginx/error.log # 看看问题出在哪

# 假设输出：2025/08/19 22:24:34 [crit] 10324#10324: *2 stat() "/home/ggxxding/www/static-web/404.html" failed (13: Permission denied), client: 142.214.203.108, server: 120.55.113.25, request: "POST /boaform/admin/formLogin HTTP/1.1", host: "120.55.113.25:80", referrer: "http://120.55.113.25:80/admin/login.asp"
```

如果看到Permission denied，那多半是权限问题了，可以再查看一下nginx.conf：

```bash
cat /etc/nginx/nginx.conf
# 第一行：user www-data;
...
```

或者看看nginx进程的用户名：

```bash
ps aux | grep nginx # 看看第一列用户名
# 一般和nginx.cinf里的user是一样的
```

可以发现都是www-data，所以只要把静态页面文件夹所有者改为它就行了（当然如果放在/var/www/下一般不会遇到这问题）：

```bash
sudo chmod -R www-data:www-data /home/xxx/<static-web> # -R 递归
sudo nginx -s reload # 重载配置
```

再刷新下公网ip页面，应该就会正确显示静态页面了。
